# Translator (Proxy) Configuration with Iroh P2P Transport
# This example shows how to connect to a Pool via Iroh instead of traditional TCP

# Local Mining Device Downstream Connection
downstream_address = "0.0.0.0"
downstream_port = 34255

# Version support
max_supported_version = 2
min_supported_version = 2

# Extranonce2 size for downstream connections
# This controls the rollable part of the extranonce for downstream miners
# Max value for CGminer: 8
# Min value: 2
downstream_extranonce2_size = 4

# User identity/username for pool connection
# This will be appended with a counter for each mining client (e.g., username.miner1, username.miner2)
user_identity = "your_username_here"

# Aggregate channels: if true, all miners share one upstream channel; if false, each miner gets its own channel
aggregate_channels = true

# Difficulty params
[downstream_difficulty_config]
# hashes/s of the weakest miner that will be connecting (e.g.: 10 Th/s = 10_000_000_000_000.0)
min_individual_miner_hashrate=10_000_000_000_000.0
# target number of shares per minute the miner should be sending
shares_per_minute = 6.0
# enable variable difficulty adjustment (true by default, set to false when using with JDC)
enable_vardiff = true

# Iroh P2P network configuration
# This enables the Translator to connect to Pools using Iroh's NAT-traversal capabilities.
[iroh_config]
# Path to store/load the Iroh secret key (ensures stable NodeId)
secret_key_path = "./translator-iroh-secret.key"

# Upstream Pool Connection via Iroh
# TODO(Phase 5): Implement Iroh transport support in Upstream::new()
#   The UpstreamTransport enum is defined but not yet used in the connection logic.
#   Once Phase 5 is complete, you will be able to configure Iroh upstreams like this:
#
# [[upstreams]]
# transport = "iroh"
# node_id = "6jfhwvskg5txs7jckzs7slqpfm3gqjr45kf7ry65vg7kqi5z7q3q"  # Pool's Iroh NodeId
# alpn = "sv2-m"  # Protocol identifier for SV2 mining
# authority_pubkey = "9auqWEzQDVyd2oe1JVGFLMLHZtCo2FFqZwtKA5gd9xbuEu7PH72"
#
# The node_id is obtained from the Pool's startup logs when it runs with Iroh enabled.
# The authority_pubkey is the same Secp256k1 key used for SV2 Noise protocol authentication.

# For now, use traditional TCP upstream:
[[upstreams]]
address = "127.0.0.1"
port = 34254
authority_pubkey = "9auqWEzQDVyd2oe1JVGFLMLHZtCo2FFqZwtKA5gd9xbuEu7PH72"

# You can also configure multiple upstreams for failover:
# [[upstreams]]
# address = "backup-pool.example.com"
# port = 34254
# authority_pubkey = "another_public_key_here"

# Enable this option to set a predefined log file path.
# When enabled, logs will always be written to this file.
# The CLI option --log-file (or -f) will override this setting if provided.
# log_file = "./tproxy.log"
